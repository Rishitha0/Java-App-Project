<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Credit Card Payment</title>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const makePaymentButton = document.getElementById('makePaymentButton');
        const paymentAmountInput = document.getElementById('paymentAmount');
        const currentBalanceSpan = document.getElementById('currentBalance');

        makePaymentButton.addEventListener('click', function () {
          const paymentAmount = parseFloat(paymentAmountInput.value);
          const currentBalance = parseFloat(currentBalanceSpan.textContent);

          if (isNaN(paymentAmount)) {
            alert('Invalid payment amount');
            return;
          }

          if (paymentAmount <= 0) {
            alert('Payment amount must be greater than 0');
            return;
          }

          if (paymentAmount > currentBalance) {
            alert('Payment amount exceeds current balance');
            return;
          }

          // Calculate new balance
          const newBalance = (currentBalance - paymentAmount).toFixed(2);

          // Update the displayed balance
          currentBalanceSpan.textContent = newBalance;

          alert('Payment successful!');
        });
      });
    </script>

  </head>
  <body>
    <h1>Credit Card Payment</h1>

    <form
      method="post"
      action="/creditCard/<%= customer.customerId %>/<%= creditCard.accountNumber %>/payment"
    >
      <h3><%= creditCard.accountName %> (....<%= creditCard.accountNumber.slice(-4) %>)</h3>
      <span id="currentBalance"><%= creditCard.currentBalance.toFixed(2) %></span>
      <br />

      <label for="paymentAmount">Payment Amount:</label>
      <input type="number" id="paymentAmount" name="paymentAmount" step="0.01" required />
      <br />

      <button type="submit" id="makePaymentButton">Make Payment</button>
    </form>

    <a href="/creditCard">Back to Credit Card Page</a>
  </body>
</html>
